(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();function X(e){return e instanceof HTMLElement}function E(){}class G{constructor(t){this._logger=t}load(t){return new Promise((i,n)=>{const s=new Image;s.src=t,s.onload=()=>{this._logger.debug("Image loaded"),i(s)},s.onerror=()=>{const r="Image not loaded: "+t;this._logger.debug(r),n(r)}})}}const M=3,L=2,x=!0,D="gold",O=2,F="round",A="rgba(255, 230, 0, .25)",R="rgb(221, 250, 182)",k="./default.jpg",U="jigsaw_puzzle_root",H=375,W=500,z=30,j=0,B=30,N=0,V=50,Q=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_BOARD_FILL:R,DEFAULT_CANVAS_HEIGHT:W,DEFAULT_CANVAS_WIDTH:H,DEFAULT_COLS:L,DEFAULT_FILL_STYLE:A,DEFAULT_FPS:z,DEFAULT_IMAGE_URL:k,DEFAULT_LINE_CAP:F,DEFAULT_LINE_WIDTH:O,DEFAULT_LOCAL_PADDING:N,DEFAULT_OFFSET:j,DEFAULT_PIECE_DISTANCE:V,DEFAULT_RADIUS:B,DEFAULT_ROOT_ELEMENT:U,DEFAULT_ROWS:M,DEFAULT_SHOW_CURVES:x,DEFAULT_STROKE_STYLE:D},Symbol.toStringTag,{value:"Module"}));class Z{constructor(t,i){this._config=t,this._logger=i,this._rows=this._config.rows||M,this._columns=this._config.columns||L,this._imageUrl=this._config.imageUrl||k,this._showCurves=this._config.showCurves||x,this._strokeStyle=this._config.strokeStyle||D,this._lineWidth=this._config.lineWidth||O,this._lineCap=this._config.lineCap||F,this._fillStyle=this._config.fillStyle||A,this._canvasWidth=this._config.canvasWidth||H,this._canvasHeight=this._config.canvasHeight||W,this._fps=this._config.fps||z,this._offset=this._config.offset||j,this._radius=this._config.radius||B,this._localPadding=this._config.localPadding||N,this._boardFill=this._config.boardFill||R,this._pieceDistance=this._config.pieceDistance||V,this._onReady=this._config.onReady||E,this._onReset=this._config.onReset||E,this._onSuccess=this._config.onSuccess||E,this._onError=this._config.onError||E,this._rootElement=this.getRoot(this._config.rootElement)}getRoot(t){return X(t)?t:(this._logger.warn("Root element is not an HTMLElement. Using default root element selector"),document.getElementById(U)||(this._logger.error("Root element not found"),null))}get localPadding(){return this._localPadding}get radius(){return this._radius}get offset(){return this._offset}get fps(){return this._fps}get onReady(){return this._onReady}get onReset(){return this._onReset}get onSuccess(){return this._onSuccess}get onError(){return this._onError}get rootElement(){return this._rootElement}get columns(){return this._columns}get fillStyle(){return this._fillStyle}get imageUrl(){return this._imageUrl}get lineCap(){return this._lineCap}get lineWidth(){return this._lineWidth}get rows(){return this._rows}get showCurves(){return this._showCurves}get strokeStyle(){return this._strokeStyle}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}get boardFill(){return this._boardFill}get pieceDistance(){return this._pieceDistance}}class K{constructor(t,i,n,s){this._config=t,this._image=i,this._pieceService=n,this._logger=s,this._rows=this._config.rows,this._columns=this._config.columns,this._x=this._config.offset,this._y=this._config.offset,this._pieceWidth=i.width/this._columns,this._pieceHeight=i.height/this._rows,this._pieces=this._pieceService.createPieces(this._x,this._y,this._rows,this._columns,this.mask.bind(this),this._image),this._logger.debug("Board constructor done")}positionByIndex(t){return{x:t%this._columns,y:Math.floor(t/this._columns)}}checkPieces(){for(let t=0,i=0;t<this._pieces.length;t++){if(this._pieces[t].index!==i||this._pieces[t].x||this._pieces[t].y)return!1;i++}return!0}unHoverPieces(){this._pieces.forEach(t=>t.unHover())}getPieceByPosition(t,i,n){return this.piecesByZDesc.find(s=>{const r=s.maskPiece();return r&&t.isPointInPath(r,i,n,"nonzero")})||null}render(t){t.save(),t.clearRect(0,0,t.canvas.width,t.canvas.height);const i=this.piecesByZAsc;if(!i.length){t.drawImage(this._image,this._x,this._y,this._image.width,this._image.height),t.restore();return}t.fillStyle=this._config.boardFill,t.rect(this._x,this._y,this._image.width,this._image.height),t.fill(),i.forEach(n=>n.render(t)),t.restore()}mask(t,i,n){return(s,r)=>{let o=new Path2D;return o.moveTo(s+this._x+t*this._pieceWidth,r+this._y+i*this._pieceHeight),i===0?o.lineTo(s+this._x+(t+1)*this._pieceWidth,r+this._y+i*this._pieceHeight):(o.lineTo(s+this._x+(t+.5)*this._pieceWidth-n,r+this._y+i*this._pieceHeight),o.arc(s+this._x+(t+.5)*this._pieceWidth,r+this._y+i*this._pieceHeight,n,Math.PI,0,!0),o.lineTo(s+this._x+(t+1)*this._pieceWidth,r+this._y+i*this._pieceHeight)),t===this._columns-1?o.lineTo(s+this._x+(t+1)*this._pieceWidth,r+this._y+(i+1)*this._pieceHeight):(o.lineTo(s+this._x+(t+1)*this._pieceWidth,r+this._y+(i+.5)*this._pieceHeight-n),o.arc(s+this._x+(t+1)*this._pieceWidth,r+this._y+(i+.5)*this._pieceHeight,n,-Math.PI/2,Math.PI/2,!1),o.lineTo(s+this._x+(t+1)*this._pieceWidth,r+this._y+(i+1)*this._pieceHeight)),i===this._rows-1?o.lineTo(s+this._x+t*this._pieceWidth,r+this._y+(i+1)*this._pieceHeight):(o.lineTo(s+this._x+(t+.5)*this._pieceWidth+n,r+this._y+(i+1)*this._pieceHeight),o.arc(s+this._x+(t+.5)*this._pieceWidth,r+this._y+(i+1)*this._pieceHeight,n,0,Math.PI,!1),o.lineTo(s+this._x+t*this._pieceWidth,r+this._y+(i+1)*this._pieceHeight)),t===0?o.lineTo(s+this._x+t*this._pieceWidth,r+this._y+i*this._pieceHeight):(o.lineTo(s+this._x+t*this._pieceWidth,r+this._y+(i+.5)*this._pieceHeight+n),o.arc(s+this._x+t*this._pieceWidth,r+this._y+(i+.5)*this._pieceHeight,n,Math.PI/2,-Math.PI/2,!0),o.lineTo(s+this._x+t*this._pieceWidth,r+this._y+i*this._pieceHeight)),o}}get pieceWidth(){return this._pieceWidth}get pieceHeight(){return this._pieceHeight}get pieces(){return this._pieces}set pieces(t){this._pieces=t}get piecesByZAsc(){return[...this._pieces].sort((t,i)=>t.z-i.z)}get piecesByZDesc(){return[...this._pieces].sort((t,i)=>i.z-t.z)}}const J=(e,t,i,n)=>new K(e,t,i,n);class ${constructor(t,i,n,s){this._boardX=t,this._boardY=i,this._config=n,this._logger=s,this._x=0,this._y=0,this._z=0,this._image=null,this._mask=null,this._isHover=!1,this._index=0,this._logger.debug("Piece constructor done")}isNearToPlace(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))<this._config.pieceDistance}hover(){this._isHover=!0,this._z=10}unHover(){this._isHover=!1,this._z=0}render(t){t.save();let i=this.maskPiece();t.strokeStyle=this._config.strokeStyle,t.lineWidth=this._config.lineWidth,t.lineCap=this._config.lineCap,i&&t.stroke(i),i&&t.clip(i,"evenodd"),this._image&&t.drawImage(this._image,this._x+this._boardX,this._y+this._boardY,this._image.width,this._image.height),this._isHover&&i&&(t.fillStyle=this._config.fillStyle,t.fill(i)),t.restore()}maskPiece(){return this._mask&&this._mask(this._x,this._y)}get mask(){return this._mask}set mask(t){this._mask=t}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get z(){return this._z}set z(t){this._z=t}get index(){return this._index}set index(t){this._index=t}get image(){return this._image}set image(t){this._image=t}}const tt=(e,t,i,n)=>new $(e,t,i,n);var p=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return this.None(e)},Out:function(e){return this.None(e)},InOut:function(e){return this.None(e)}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-p.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?p.Bounce.In(e*2)*.5:p.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(t*2,e)/2:(1-Math.pow(2-t*2,e))/2+.5}}}}),S=function(){return performance.now()},et=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(i){return t._tweens[i]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},e.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},e.prototype.update=function(t,i){t===void 0&&(t=S()),i===void 0&&(i=!1);var n=Object.keys(this._tweens);if(n.length===0)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<n.length;s++){var r=this._tweens[n[s]],o=!i;r&&r.update(t,o)===!1&&!i&&delete this._tweens[n[s]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),f={Linear:function(e,t){var i=e.length-1,n=i*t,s=Math.floor(n),r=f.Utils.Linear;return t<0?r(e[0],e[1],n):t>1?r(e[i],e[i-1],i-n):r(e[s],e[s+1>i?i:s+1],n-s)},Bezier:function(e,t){for(var i=0,n=e.length-1,s=Math.pow,r=f.Utils.Bernstein,o=0;o<=n;o++)i+=s(1-t,n-o)*s(t,o)*e[o]*r(n,o);return i},CatmullRom:function(e,t){var i=e.length-1,n=i*t,s=Math.floor(n),r=f.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(s=Math.floor(n=i*(1+t))),r(e[(s-1+i)%i],e[s],e[(s+1)%i],e[(s+2)%i],n-s)):t<0?e[0]-(r(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(r(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):r(e[s?s-1:0],e[s],e[i<s+1?i:s+1],e[i<s+2?i:s+2],n-s)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=f.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i=1;if(e[t])return e[t];for(var n=t;n>1;n--)i*=n;return e[t]=i,i}}(),CatmullRom:function(e,t,i,n,s){var r=(i-e)*.5,o=(n-t)*.5,h=s*s,a=s*h;return(2*t-2*i+r+o)*a+(-3*t+3*i-2*r-o)*h+r*s+t}}},it=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),T=new et,Y=function(){function e(t,i){i===void 0&&(i=T),this._object=t,this._group=i,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=p.Linear.None,this._interpolationFunction=f.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=it.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(t,i){if(i===void 0&&(i=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=i<0?0:i,this},e.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t<0?0:t,this},e.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},e.prototype.start=function(t,i){if(t===void 0&&(t=S()),i===void 0&&(i=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||i){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var r in this._valuesEnd)s[r]=this._valuesEnd[r];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,i)}return this},e.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},e.prototype._setupProperties=function(t,i,n,s,r){for(var o in n){var h=t[o],a=Array.isArray(h),c=a?"array":typeof h,_=!a&&Array.isArray(n[o]);if(!(c==="undefined"||c==="function")){if(_){var u=n[o];if(u.length===0)continue;for(var b=[h],g=0,v=u.length;g<v;g+=1){var w=this._handleRelativeValue(h,u[g]);if(isNaN(w)){_=!1,console.warn("Found invalid interpolation list. Skipping.");break}b.push(w)}_&&(n[o]=b)}if((c==="object"||a)&&h&&!_){i[o]=a?[]:{};var m=h;for(var d in m)i[o][d]=m[d];s[o]=a?[]:{};var u=n[o];if(!this._isDynamic){var y={};for(var d in u)y[d]=u[d];n[o]=u=y}this._setupProperties(m,i[o],u,s[o],r)}else(typeof i[o]>"u"||r)&&(i[o]=h),a||(i[o]*=1),_?s[o]=n[o].slice().reverse():s[o]=i[o]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(t){return t===void 0&&(t=S()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},e.prototype.resume=function(t){return t===void 0&&(t=S()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},e.prototype.stopChainedTweens=function(){for(var t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop();return this},e.prototype.group=function(t){return t===void 0&&(t=T),this._group=t,this},e.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},e.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},e.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},e.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},e.prototype.easing=function(t){return t===void 0&&(t=p.Linear.None),this._easingFunction=t,this},e.prototype.interpolation=function(t){return t===void 0&&(t=f.Linear),this._interpolationFunction=t,this},e.prototype.chain=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this._chainedTweens=t,this},e.prototype.onStart=function(t){return this._onStartCallback=t,this},e.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},e.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},e.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},e.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},e.prototype.onStop=function(t){return this._onStopCallback=t,this},e.prototype.update=function(t,i){var n=this,s;if(t===void 0&&(t=S()),i===void 0&&(i=!0),this._isPaused)return!0;var r,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;i&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var h=t-this._startTime,a=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),c=this._duration+this._repeat*a,_=function(){if(n._duration===0||h>c)return 1;var m=Math.trunc(h/a),d=h-m*a,y=Math.min(d/n._duration,1);return y===0&&h===n._duration?1:y},u=_(),b=this._easingFunction(u);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,b),this._onUpdateCallback&&this._onUpdateCallback(this._object,u),this._duration===0||h>=this._duration)if(this._repeat>0){var g=Math.min(Math.trunc((h-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=g);for(r in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]=="string"&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*g,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var v=0,w=this._chainedTweens.length;v<w;v++)this._chainedTweens[v].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(t,i,n,s){for(var r in n)if(i[r]!==void 0){var o=i[r]||0,h=n[r],a=Array.isArray(t[r]),c=Array.isArray(h),_=!a&&c;_?t[r]=this._interpolationFunction(h,s):typeof h=="object"&&h?this._updateProperties(t[r],o,h,s):(h=this._handleRelativeValue(o,h),typeof h=="number"&&(t[r]=o+(h-o)*s))}},e.prototype._handleRelativeValue=function(t,i){return typeof i!="string"?i:i.charAt(0)==="+"||i.charAt(0)==="-"?t+parseFloat(i):parseFloat(i)},e.prototype._swapEndStartRepeatValues=function(t){var i=this._valuesStartRepeat[t],n=this._valuesEnd[t];typeof n=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(n):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=i},e}(),l=T;l.getAll.bind(l);l.removeAll.bind(l);l.add.bind(l);l.remove.bind(l);var st=l.update.bind(l);class nt{constructor(t,i,n,s,r,o,h){if(this._config=t,this._imageService=i,this._canvasService=n,this._boardService=s,this._shuffleService=r,this._uiService=o,this._logger=h,this._image=null,this._canvas=null,this._board=null,this._deltaTime=0,this._fpsDeltaTime=0,this._fpsDeltaLimit=0,!this._config.rootElement){this._logger.error("Root element not found");return}this.fpsDeltaLimit=1e3/this._config.fps,this.reset().then(()=>{this.render(0),this._logger.debug("Game ready"),this._config.onReady()}).catch(a=>{this._logger.error(a),this._logger.error("Game not ready"),this._config.onError("game.init.error")})}shuffle(){this._shuffleService.shuffle(this.board,this.canvas),this._uiService.setShuffled(!0)}async reset(){this._canvasService.clear(),this._logger.debug("Canvas cleared"),this.image=await this._imageService.load(this._config.imageUrl),this._logger.debug("Image received"),this.canvas=this._canvasService.createCanvas(),this._logger.debug("Canvas created"),this._canvasService.setSize(this.canvas,this.image),this._logger.debug("Canvas prepared"),this.ctx.drawImage(this.image,0,0,this.canvas.width,this.canvas.height),this._logger.debug("Image drawn on canvas"),this.rootElement.appendChild(this.canvas),this._logger.debug("Canvas appended to root element"),this.board=this._boardService.createBoard(this.image),this._logger.debug("Board created"),this._uiService.addListeners(this.canvas,this.board,this.ctx,this._config.onSuccess),this._logger.debug("UIService ready")}render(t){this.deltaTime=t-this.deltaTime,this.fpsDeltaTime=this.fpsDeltaTime+this.deltaTime,this.fpsDeltaTime>=this.fpsDeltaLimit&&(st(t),this.board.render(this.ctx),this.fpsDeltaTime=0),this.deltaTime=t,requestAnimationFrame(this.render.bind(this))}get fpsDeltaTime(){return this._fpsDeltaTime}set fpsDeltaTime(t){this._fpsDeltaTime=t}get deltaTime(){return this._deltaTime}set deltaTime(t){this._deltaTime=t}get fpsDeltaLimit(){return this._fpsDeltaLimit}set fpsDeltaLimit(t){this._fpsDeltaLimit=t}get board(){return this._board}set board(t){this._board=t}get image(){return this._image}set image(t){this._image=t}get canvas(){return this._canvas}set canvas(t){this._canvas=t}get ctx(){return this.canvas.getContext("2d")}get rootElement(){return this._config.rootElement}}class rt{constructor(t,i,n,s){this._boardFactory=t,this._config=i,this._pieceService=n,this._logger=s}createBoard(t){const i=this._boardFactory(this._config,t,this._pieceService,this._logger);return this._logger.debug("Board instantiated"),i}}class ot{constructor(t,i){this._config=t,this._logger=i}clear(){this._config.rootElement.innerHTML=""}createCanvas(){return document.createElement("canvas")}setSize(t,i){const{width:n,height:s}=this.getFitSize(i);t.width=n,t.height=s,i.width=n,i.height=s}getFitSize(t){const i=this.getImageRatio(t),{canvasWidth:n}=this.canvasSize;return{height:n/i,width:n}}getImageRatio({width:t,height:i}){return t===0&&this._logger.warn("Image width is 0"),i===0&&this._logger.warn("Image height is 0"),i===t||i===0||t===0?1:t/i}get canvasSize(){const t=this.rootWidth,{canvasWidth:i,canvasHeight:n}=this._config;if(i<=t)return{canvasHeight:n,canvasWidth:i};const s=i/n;return{canvasHeight:t/s,canvasWidth:t}}get rootWidth(){return this._config.rootElement.clientWidth}}class ht{constructor(t,i,n){this._pieceFactory=t,this._config=i,this._logger=n}createPieces(t,i,n,s,r,o){const h=[];for(let a=0;a<n;a++)for(let c=0;c<s;c++){const _=this.createPiece(t,i);_.image=o,_.index=this.getIndex(c,a,s),_.mask=r(c,a,this._config.radius),h.push(_)}return this._logger.debug("Pieces instantiated"),h}createPiece(t,i){const n=this._pieceFactory(t,i,this._config,this._logger);return this._logger.debug("Piece instantiated"),n}getIndex(t,i,n){return t+i*n}}class at{constructor(t,i){this._config=t,this._logger=i}shuffle(t,i){this._logger.debug("Shuffling");const n=this.randomizePiecePositions(t,i);this._logger.debug("Got pieces positions"),this.animatePieces(t,n),this._logger.debug("Shuffled")}randomizePiecePositions(t,i){const n=this.getLimits(i),s=t.pieceHeight,r=t.pieceWidth;return t.pieces.reduce((o,h,a)=>{const c=t.positionByIndex(a);return o.randomPosition.push(this.getPieceRandomPosition(c,s,r,n)),o.currentPosition.push({x:0,y:0}),o},this.getInitialPositions())}getLimits(t){return{left:this._config.localPadding,top:this._config.localPadding,right:t.width-2*this._config.localPadding,bottom:t.height-2*this._config.localPadding}}getPieceRandomPosition(t,i,n,s){const r=t.x*n,o=t.y*i;return{x:s.left-r+Math.random()*(s.right-s.left-n),y:s.top-o+Math.random()*(s.bottom-s.top-i)}}getInitialPositions(){return{randomPosition:[],currentPosition:[]}}animatePieces(t,i){t.pieces.forEach((n,s)=>new Y(i.currentPosition[s]).to(i.randomPosition[s],1e3).easing(p.Quadratic.Out).onUpdate(()=>{n.x=i.currentPosition[s].x,n.y=i.currentPosition[s].y,n.z=s+10}).onComplete(()=>n.z=0).start())}}class P{constructor(t){this._logger=t,this._shuffled=!1}addListeners(t,i,n,s){const r=this.getInitialState();t.addEventListener("pointerenter",this.onEnter(r)),t.addEventListener("pointerleave",this.onLeave(r)),t.addEventListener("pointermove",this.onMove(r,i,n)),t.addEventListener("pointerdown",this.onDown(r,i,n)),t.addEventListener("pointerup",this.onUp(r,i,s)),this._shuffled=!1,this._logger.debug("Canvas listeners added")}onEnter(t){return()=>{t._isMouseIn=!0}}onLeave(t){return()=>{t._isMouseIn=!1,t._isPieceMoving=!1,t._piece=null}}onMove(t,i,n){return s=>{P.isMouse(s)&&t._isMouseIn&&!t._isPieceMoving&&(t._piece=i.getPieceByPosition(n,s.offsetX,s.offsetY),i.unHoverPieces(),t._piece&&t._piece.hover()),P.isTouch(s)&&t._piece&&t._isPieceMoving?(t._piece.x+=s.movementX,t._piece.y+=s.movementY):t._piece&&t._isPieceMoving&&(t._piece.x+=s.offsetX-t._pointerCoordinates.x,t._piece.y+=s.offsetY-t._pointerCoordinates.y),t._pointerCoordinates={x:s.offsetX,y:s.offsetY}}}onDown(t,i,n){return s=>{P.isTouch(s)&&t._isMouseIn&&!t._isPieceMoving&&(t._piece=i.getPieceByPosition(n,s.offsetX,s.offsetY),i.unHoverPieces(),t._piece&&t._piece.hover()),t._piece&&(t._isPieceMoving=!0)}}onUp(t,i,n){return()=>{if(t._isPieceMoving=!1,t._piece&&t._piece.isNearToPlace()){const s={x:t._piece.x,y:t._piece.y};new Y(s).to({x:0,y:0},250).easing(p.Quadratic.In).onUpdate(()=>{t._piece&&(t._piece.x=s.x,t._piece.y=s.y,t._piece.z=10)}).onComplete(()=>{t._piece&&(t._piece.x=0,i.checkPieces()&&this._shuffled&&(n(),i.pieces=[]))}).start()}t._piece=null}}static isMouse(t){return t.pointerType==="mouse"}static isTouch(t){return t.pointerType==="touch"}getInitialState(){return{_isMouseIn:!1,_isPieceMoving:!1,_piece:null,_pointerCoordinates:{x:0,y:0}}}setShuffled(t){this._shuffled=t}}function ct(e,t=console){const i=new Z(e,t),n=new G(t),s=new ot(i,t),r=new ht(tt,i,t),o=new rt(J,i,r,t),h=new at(i,t),a=new P(t);return new nt(i,n,s,o,h,a,t)}const q=ct({rootElement:document.getElementById(Q.DEFAULT_ROOT_ELEMENT)}),I=document.getElementById("shuffle");I&&I.addEventListener("click",()=>{q.shuffle()});const C=document.getElementById("reset");C&&C.addEventListener("click",async()=>{await q.reset()});
//# sourceMappingURL=jigsawPuzzle-C6qdad_X.js.map
